#ifndef CARD_PROCESSOR_H
#define CARD_PROCESSOR_H

#include "stdint.h"

#define HOLES_COUNT 12
#define DATA_BITS_COUNT 12

typedef enum {
  s_WAIT_FOR_CARD = 0,
  s_WAIT_FOR_COLUMN = 1,
  s_COLUMN_ENDED = 2,
} ProcessorState;

typedef struct {
  bool holes[HOLES_COUNT];
} PunchReadings;

typedef struct {
  ProcessorState state;
  PunchReadings prevPunched;
} ProcessorData;

const char hollerith[256][7] PROGMEM = {
    { 0, 2, 11, 10, 3, -1 },
    { 0, 11, 3, -1 },
    { 0, 11, 4, -1 },
    { 0, 11, 5, -1 },
    { 11, 9, -1 },
    { 2, 11, 10, 7, -1 },
    { 2, 11, 10, 8, -1 },
    { 2, 11, 10, 9, -1 },
    { 1, 11, 8, -1 },
    { 0, 11, 7, -1 },
    { 2, 11, 7, -1 },
    { 0, 11, 10, 5, -1 },
    { 0, 11, 10, 6, -1 },
    { 0, 11, 10, 7, -1 },
    { 0, 11, 10, 8, -1 },
    { 0, 11, 10, 9, -1 },
    { 0, 1, 11, 10, 3, -1 },
    { 1, 11, 3, -1 },
    { 1, 11, 4, -1 },
    { 1, 11, 5, -1 },
    { 11, 10, 6, -1 },
    { 11, 10, 7, -1 },
    { 11, 4, -1 },
    { 2, 11, 8, -1 },
    { 1, 11, 10, -1 },
    { 1, 11, 10, 3, -1 },
    { 11, 10, 9, -1 },
    { 2, 11, 9, -1 },
    { 1, 11, 10, 6, -1 },
    { 1, 11, 10, 7, -1 },
    { 1, 11, 10, 8, -1 },
    { 1, 11, 10, 9, -1 },
    { -1 },
    { 0, 10, 9, -1 },
    { 10, 9, -1 },
    { 10, 5, -1 },
    { 1, 10, 5, -1 },
    { 2, 10, 6, -1 },
    { 0, -1 },
    { 10, 7, -1 },
    { 0, 10, 7, -1 },
    { 1, 10, 7, -1 },
    { 1, 10, 6, -1 },
    { 0, 10, 8, -1 },
    { 2, 10, 5, -1 },
    { 1, -1 },
    { 0, 10, 5, -1 },
    { 2, 3, -1 },
    { 2, -1 },
    { 3, -1 },
    { 4, -1 },
    { 5, -1 },
    { 6, -1 },
    { 7, -1 },
    { 8, -1 },
    { 9, -1 },
    { 10, -1 },
    { 11, -1 },
    { 10, 4, -1 },
    { 1, 10, 8, -1 },
    { 0, 10, 6, -1 },
    { 10, 8, -1 },
    { 2, 10, 8, -1 },
    { 2, 10, 9, -1 },
    { 10, 6, -1 },
    { 0, 3, -1 },
    { 0, 4, -1 },
    { 0, 5, -1 },
    { 0, 6, -1 },
    { 0, 7, -1 },
    { 0, 8, -1 },
    { 0, 9, -1 },
    { 0, 10, -1 },
    { 0, 11, -1 },
    { 1, 3, -1 },
    { 1, 4, -1 },
    { 1, 5, -1 },
    { 1, 6, -1 },
    { 1, 7, -1 },
    { 1, 8, -1 },
    { 1, 9, -1 },
    { 1, 10, -1 },
    { 1, 11, -1 },
    { 2, 4, -1 },
    { 2, 5, -1 },
    { 2, 6, -1 },
    { 2, 7, -1 },
    { 2, 8, -1 },
    { 2, 9, -1 },
    { 2, 10, -1 },
    { 2, 11, -1 },
    { 0, 10, 4, -1 },
    { 2, 10, 4, -1 },
    { 1, 10, 4, -1 },
    { 1, 10, 9, -1 },
    { 2, 10, 7, -1 },
    { 10, 3, -1 },
    { 0, 2, 3, -1 },
    { 0, 2, 4, -1 },
    { 0, 2, 5, -1 },
    { 0, 2, 6, -1 },
    { 0, 2, 7, -1 },
    { 0, 2, 8, -1 },
    { 0, 2, 9, -1 },
    { 0, 2, 10, -1 },
    { 0, 2, 11, -1 },
    { 0, 1, 3, -1 },
    { 0, 1, 4, -1 },
    { 0, 1, 5, -1 },
    { 0, 1, 6, -1 },
    { 0, 1, 7, -1 },
    { 0, 1, 8, -1 },
    { 0, 1, 9, -1 },
    { 0, 1, 10, -1 },
    { 0, 1, 11, -1 },
    { 1, 2, 4, -1 },
    { 1, 2, 5, -1 },
    { 1, 2, 6, -1 },
    { 1, 2, 7, -1 },
    { 1, 2, 8, -1 },
    { 1, 2, 9, -1 },
    { 1, 2, 10, -1 },
    { 1, 2, 11, -1 },
    { 0, 2, -1 },
    { 0, 1, -1 },
    { 1, 2, -1 },
    { 1, 2, 3, -1 },
    { 0, 11, 9, -1 },
    { 1, 2, 11, 10, 3, -1 },
    { 2, 11, 3, -1 },
    { 2, 11, 4, -1 },
    { 2, 11, 5, -1 },
    { 2, 11, 6, -1 },
    { 1, 11, 7, -1 },
    { 0, 11, 8, -1 },
    { 1, 11, 9, -1 },
    { 2, 11, 10, -1 },
    { 2, 11, 10, 3, -1 },
    { 2, 11, 10, 4, -1 },
    { 2, 11, 10, 5, -1 },
    { 2, 11, 10, 6, -1 },
    { 0, 11, 10, 3, -1 },
    { 0, 11, 10, 4, -1 },
    { 1, 11, 10, 5, -1 },
    { 0, 1, 2, 11, 10, 3, -1 },
    { 11, 3, -1 },
    { 1, 11, 10, 4, -1 },
    { 11, 5, -1 },
    { 11, 6, -1 },
    { 11, 7, -1 },
    { 11, 8, -1 },
    { 0, 11, 10, -1 },
    { 11, 10, -1 },
    { 11, 10, 3, -1 },
    { 11, 10, 4, -1 },
    { 11, 10, 5, -1 },
    { 0, 11, 6, -1 },
    { 1, 11, 6, -1 },
    { 11, 10, 8, -1 },
    { 1, 2, 11, 3, -1 },
    { 0, 2, 11, 3, -1 },
    { 0, 2, 11, 4, -1 },
    { 0, 2, 11, 5, -1 },
    { 0, 2, 11, 6, -1 },
    { 0, 2, 11, 7, -1 },
    { 0, 2, 11, 8, -1 },
    { 0, 2, 11, 9, -1 },
    { 0, 2, 11, 10, -1 },
    { 0, 10, 3, -1 },
    { 0, 1, 11, 3, -1 },
    { 0, 1, 11, 4, -1 },
    { 0, 1, 11, 5, -1 },
    { 0, 1, 11, 6, -1 },
    { 0, 1, 11, 7, -1 },
    { 0, 1, 11, 8, -1 },
    { 0, 1, 11, 9, -1 },
    { 0, 1, 11, 10, -1 },
    { 1, 10, 3, -1 },
    { 1, 2, 11, 4, -1 },
    { 1, 2, 11, 5, -1 },
    { 1, 2, 11, 6, -1 },
    { 1, 2, 11, 7, -1 },
    { 1, 2, 11, 8, -1 },
    { 1, 2, 11, 9, -1 },
    { 1, 2, 11, 10, -1 },
    { 2, 10, 3, -1 },
    { 0, 1, 2, -1 },
    { 0, 1, 2, 11, 3, -1 },
    { 0, 1, 2, 11, 4, -1 },
    { 0, 1, 2, 11, 5, -1 },
    { 0, 1, 2, 11, 6, -1 },
    { 0, 1, 2, 11, 7, -1 },
    { 0, 1, 2, 11, 8, -1 },
    { 0, 1, 2, 11, 9, -1 },
    { 0, 1, 2, 11, 10, -1 },
    { 0, 2, 10, 3, -1 },
    { 0, 2, 10, 4, -1 },
    { 0, 2, 10, 5, -1 },
    { 0, 2, 10, 6, -1 },
    { 0, 2, 10, 7, -1 },
    { 0, 2, 10, 8, -1 },
    { 0, 2, 10, 9, -1 },
    { 0, 1, 10, 3, -1 },
    { 0, 1, 10, 4, -1 },
    { 0, 1, 10, 5, -1 },
    { 0, 1, 10, 6, -1 },
    { 0, 1, 10, 7, -1 },
    { 0, 1, 10, 8, -1 },
    { 0, 1, 10, 9, -1 },
    { 1, 2, 10, 3, -1 },
    { 1, 2, 10, 4, -1 },
    { 1, 2, 10, 5, -1 },
    { 1, 2, 10, 6, -1 },
    { 1, 2, 10, 7, -1 },
    { 1, 2, 10, 8, -1 },
    { 1, 2, 10, 9, -1 },
    { 0, 1, 2, 10, 3, -1 },
    { 0, 1, 2, 3, -1 },
    { 0, 1, 2, 4, -1 },
    { 0, 1, 2, 5, -1 },
    { 0, 1, 2, 6, -1 },
    { 0, 1, 2, 7, -1 },
    { 0, 1, 2, 8, -1 },
    { 0, 1, 2, 9, -1 },
    { 0, 1, 2, 10, -1 },
    { 0, 1, 2, 11, -1 },
    { 0, 1, 2, 10, 4, -1 },
    { 0, 1, 2, 10, 5, -1 },
    { 0, 1, 2, 10, 6, -1 },
    { 0, 1, 2, 10, 7, -1 },
    { 0, 1, 2, 10, 8, -1 },
    { 0, 1, 2, 10, 9, -1 },
    { 0, 2, 11, 10, 4, -1 },
    { 0, 2, 11, 10, 5, -1 },
    { 0, 2, 11, 10, 6, -1 },
    { 0, 2, 11, 10, 7, -1 },
    { 0, 2, 11, 10, 8, -1 },
    { 0, 2, 11, 10, 9, -1 },
    { 0, 1, 11, 10, 4, -1 },
    { 0, 1, 11, 10, 5, -1 },
    { 0, 1, 11, 10, 6, -1 },
    { 0, 1, 11, 10, 7, -1 },
    { 0, 1, 11, 10, 8, -1 },
    { 0, 1, 11, 10, 9, -1 },
    { 1, 2, 11, 10, 4, -1 },
    { 1, 2, 11, 10, 5, -1 },
    { 1, 2, 11, 10, 6, -1 },
    { 1, 2, 11, 10, 7, -1 },
    { 1, 2, 11, 10, 8, -1 },
    { 1, 2, 11, 10, 9, -1 },
    { 0, 1, 2, 11, 10, 4, -1 },
    { 0, 1, 2, 11, 10, 5, -1 },
    { 0, 1, 2, 11, 10, 6, -1 },
    { 0, 1, 2, 11, 10, 7, -1 },
    { 0, 1, 2, 11, 10, 8, -1 },
    { 0, 1, 2, 11, 10, 9, -1 }
};

const PunchReadings c_ZEROED_READINGS = { .holes = { false } };

ProcessorData updateProcessorData(ProcessorData current, PunchReadings punched);

#endif // CARD_PROCESSOR_H
